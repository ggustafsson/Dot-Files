#!/usr/bin/env zsh

# Written by GÃ¶ran Gustafsson <gustafsson.g@gmail.com>.

# Description: This script configures a OS X system the way i like.

# Usage: setup_osx

sudo echo "Testing if this user is allowed to use sudo."

if [[ $? -eq 1 ]]; then
  echo "User is not allowed to use sudo! Exiting..."
  exit 1
fi

if [[ ! -d /Applications/Xcode.app ]]; then
  echo "Install Xcode first! Exiting..."
  exit 1
fi

if [[ ! -f ~/.ssh/id_rsa ]]; then
  echo "Install the SSH key first! Exiting..."
  exit 1
fi

echo -n "\nWhat hostname do you want? "
read new_hostname

if [[ -z $new_hostname ]]; then
  echo "No hostname supplied! Exiting..."
  exit 1
fi

# Override hostname from DHCP server.
sudo scutil --set HostName $new_hostname

# Check for updates daily instead of once a week.
sudo defaults write /Library/Preferences/com.apple.SoftwareUpdate ScheduleFrequency -int 1

# Remove the hide/show delay of the Dock and make animations slightly faster.
defaults write com.apple.dock autohide-delay -float 0
defaults write com.apple.dock autohide-time-modifier -float 0.65

killall Dock

# Install Xcode Command Line Tools.
echo
xcode-select --install

echo "Press enter when Command Line Tools are installed and tested."
read answer

git clone https://github.com/mxcl/homebrew.git ~/Downloads/homebrew
sudo mv ~/Downloads/homebrew /usr/local

/usr/local/bin/brew tap homebrew/dupes

/usr/local/bin/brew install \
  bash \
  coreutils \
  curl \
  ffmpeg \
  flac \
  gawk \
  git \
  gnu-sed \
  html2text \
  imagemagick --without-x \
  imagesnap \
  lame \
  macvim \
  ncftp \
  nmap \
  openssh \
  python \
  python3 \
  renameutils \
  rsync \
  ruby \
  svtplay-dl \
  tidy \
  tmux \
  tree \
  vim \
  vorbis-tools \
  weechat \
  wget \
  youtube-dl \
  zsh

if [[ ! -d ~/Applications ]]; then
  mkdir ~/Applications
fi

brew linkapps --local

echo "Adding new Zsh to login shells:"
echo "/usr/local/bin/zsh" | sudo tee -a /etc/shells

ln -s /usr/local/bin/ghead /usr/local/bin/head
ln -s /usr/local/bin/gls /usr/local/bin/ls
ln -s /usr/local/bin/gsed /usr/local/bin/sed
ln -s /usr/local/bin/gsort /usr/local/bin/sort
ln -s /usr/local/bin/gtail /usr/local/bin/tail
ln -s /usr/local/bin/guniq /usr/local/bin/uniq
ln -s /usr/local/bin/gwc /usr/local/bin/wc

echo
/usr/local/bin/pip install mutagen

echo
~/Scripts/setup_dotfiles
~/Scripts/OSX/dl_misc
