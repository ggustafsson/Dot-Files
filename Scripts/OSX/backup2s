#!/usr/bin/env zsh

# Written by GÃ¶ran Gustafsson <gustafsson.g@gmail.com>.

# Description: This script backs up several directories to two servers with
# rsync (one through ssh and one locally mounted).

# Usage: backup2s

server=hoth
server2=tatooine

destination=/media/external
destination2=/Volumes/External

directories=(
  /Volumes/External/Disk\ Images
  /Volumes/External/Documentaries
  /Volumes/External/Movies
  /Volumes/External/Series
  ~/Music/FLAC
  ~/Music/MP3
  ~/YouTube
)

directories2=(
  ~/Music/FLAC
  ~/Music/MP3
)

if [[ ! -d $destination2 ]]; then
  echo "\nDirectory '$destination' does not exist! Exiting..."
  exit 1
fi

echo "Backing up directories to server '$server'."

for directory in $directories; do
  if [[ -d $directory || -f $directory ]]; then
    print -P "\n%B%F{green}Backing up directory ${directory/$HOME/~}.%f%b"
    rsync --archive --delete --human-readable --progress $directory -e ssh ${server}:$destination
  else
    echo "\nDirectory '${directory/$HOME/~}' not found! Exiting..."
    exit 1
  fi
done

echo "\nBacking up directories to server '$server2'."

for directory in $directories2; do
  if [[ -d $directory || -f $directory ]]; then
    print -P "\n%B%F{green}Backing up directory ${directory/$HOME/~}.%f%b"
    rsync --archive --delete --human-readable --progress $directory $destination2
  else
    echo "\nDirectory '${directory/$HOME/~}' not found! Exiting..."
    exit 1
  fi
done
