#!/usr/bin/env zsh

# Description: This script backs up a few specific directories/files to device.
#
# Usage: backup
#
# Written by GÃ¶ran Gustafsson (gustafsson.g at gmail.com).
# License: BSD 3-Clause.

destination=/Volumes/Keychain

backup_objects=(
  ~/.ssh
  ~/Development
  ~/Documents
  ~/Downloads
  ~/Dropbox
  ~/Golang
  ~/Library/Application\ Support/OpenEmu
  ~/Library/Containers/com.apple.iWork.Pages/Data/Library/Application\ Support/User\ Templates
  ~/Library/Safari/Bookmarks.plist
  ~/Movies
  ~/Music/FLAC
  ~/Music/GBS
  ~/Music/MP3
  ~/Music/NSFe
  ~/Pictures
  ~/Projects
  ~/School
  ~/Sites
  ~/Storage
  ~/Web\ Archives
)

if [[ ! -d $destination ]]; then
  echo "\nDirectory '${destination}' does not exist! Exiting..."
  exit 1
fi

for object in $backup_objects; do
  if [[ -a $object ]]; then
    print -P "\n%B%F{green}Backing up: ${object/${HOME}/~}%f%b"
    rsync --archive --delete --exclude=Dropbox/.dropbox.cache \
      --exclude=Dropbox/Public/Tmp --exclude=Dropbox/Shared\ Files \
      --human-readable --verbose \
      $object $destination
  else
    echo "\nObject '${object}' not found! Exiting..."
    exit 1
  fi
done

echo "\nUnmounting external device."
diskutil eject $destination
