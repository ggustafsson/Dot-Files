#!/usr/bin/env zsh

# Written by GÃ¶ran Gustafsson <gustafsson.g@gmail.com>.

# Description: This script changes the permissions on all files and
# directories under the specified path (including the root directory). The
# permissions used are 755 for directories and 644 for files. It also removes
# all of the extra permission attributes under OS X.

# Usage: perml <path>

if [[ ! $# -eq 1 ]]; then
  echo "Usage: $0:t [PATH]..."
  exit
fi

if [[ ! -d $1 ]]; then
  echo "Directory '$1' does not exist\!"
  return 1
fi

echo "Changing permissions recursively on directory '$1'."

if [[ $OSTYPE == darwin* ]]; then
  find $1 -type d -exec chmod -N "{}" \; -exec chmod 755 "{}" \;
  find $1 -type f -exec chmod -N "{}" \; -exec chmod 644 "{}" \;
else
  find $1 -type d -exec chmod 755 "{}" \;
  find $1 -type f -exec chmod 644 "{}" \;
fi
