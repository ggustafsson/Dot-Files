#!/usr/bin/env zsh

# Written by GÃ¶ran Gustafsson <gustafsson.g@gmail.com>.

# Description: This script checks the git status of all my projects.

# Usage: chkp

for directory in ~/Projects/*; do
  cd $directory

  if [[ -n $(git rev-list origin..HEAD 2> /dev/null) ]]; then
    print -P "%B%F{cyan}$directory:t:%f%b"
    git status --branch --short
    echo
  elif [[ -n $(git status --short 2> /dev/null) ]]; then
    print -P "%B%F{red}$directory:t:%f%b"
    git status --branch --short
    echo
  elif [[ -d .git ]]; then
    clean_repos+=($directory:t)
  else
    not_repos+=($directory:t)
  fi
done

if [[ ${#clean_repos} -gt 0 ]]; then
  print -P "%B%F{green}Clean repo(s):%f%b"
  for REPO in $clean_repos; do
    echo " * $REPO"
  done
fi

[[ ${#clean_repos} -gt 0 && ${#not_repos} -gt 0 ]] && echo

if [[ ${#not_repos} -gt 0 ]]; then
  print -P "%B%F{blue}Not Git repo(s):%f%b"
  for name in $not_repos; do
    echo " * $name"
  done
fi
