#!/usr/bin/env zsh

# Written by GÃ¶ran Gustafsson <gustafsson.g@gmail.com>.

# Description: This script joins a specific IRC channel and slaps someone.

# Usage: slapbot2000 nick trout

pid=$!
irc_stream=/tmp/irc_stream

if [[ ! $# -eq 2 ]]; then
  echo "Usage: ${0:t} [NICK]... [WITH]..."
  exit
fi

echo "NICK slapbot2000" > $irc_stream
echo "USER slapbot2000 0 * :Hehe" >> $irc_stream

tail -f $irc_stream | nc -i 1 se.quakenet.org 6667 | while read message; do
  echo $message

  if [[ $message == PING* ]]; then
    echo "PONG${message#PING}" >> $irc_stream
    sleep 10
    echo "JOIN #degiz" >> $irc_stream
    echo -e "PRIVMSG #degiz :\x01ACTION slaps $1 around a bit with a large $2\x01" >> $irc_stream
    echo "QUIT :Hehe" >> $irc_stream
    sleep 5
    rm $irc_stream
    kill $pid
  fi
done
